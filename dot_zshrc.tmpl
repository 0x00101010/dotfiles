eval "$(mise activate zsh)"

export EDITOR=/opt/homebrew/bin/nvim
export RUSTROVER_PATH="/Applications/RustRover.app/Contents/MacOS"
export PATH="$HOME/.local/bin:$PATH:$RUSTROVER_PATH"
export XDG_CONFIG_HOME="$HOME/.config"

# Path to your oh-my-zsh installation.
export ZSH="$HOME/.oh-my-zsh"

autoload bashcompinit && bashcompinit
autoload -Uz compinit && compinit
source <(kubectl completion zsh)
complete -C '/opt/homebrew/bin/aws_completer' aws

LISTMAX=10000

# zmodload zsh/complist
# setopt AUTO_MENU                  # start menu on repeated <Tab>
# setopt MENU_COMPLETE              # cycle through items with <Tab>

# # Use a scrollable menu, vertical, with selection
# zstyle ':completion:*' menu yes select
# zstyle ':completion:*' group-name ''            # group results by type
# zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}  # colored entries
# zstyle ':completion:*' fzf-search-display true
# zstyle ':completion:*' fzf-pad 4
# zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}' 'r:|[._-]=** r:|=**'
# zstyle ':completion:*:descriptions' format '%F{yellow}%d%f'
# zstyle ':fzf-tab:*' switch-group '<' '>'          # jump groups with < / >
# zstyle ':fzf-tab:complete:*' fzf-preview 'less -R {} 2>/dev/null || cat {} 2>/dev/null'
# zstyle ':fzf-tab:complete:cd:*' fzf-preview 'ls --color=always -la {} 2>/dev/null'

# Load zsh completion and complist
zmodload zsh/complist
setopt AUTO_MENU                 # start menu on repeated <Tab>
setopt MENU_COMPLETE             # cycle through items with <Tab>

# Base zsh completion styles
zstyle ':completion:*' menu yes select
zstyle ':completion:*' group-name ''             # group results by type
zstyle ':completion:*:descriptions' format '%F{yellow}%d%f'
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}  # colored entries
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}' \
    'r:|[._-]=** r:|=**'

# --- fzf-tab setup ---
# Global flags for fzf
zstyle ':fzf-tab:*' fzf-flags --layout=reverse-list --height=60% --ansi --cycle --info=inline

# Preview window (right half of terminal)
zstyle ':fzf-tab:*' fzf-preview-window 'right:50%:wrap'

# Safe preview for generic completions
zstyle ':fzf-tab:complete:*:*' fzf-preview \
'if [[ -d $realpath ]]; then ls -la "$realpath"; \
elif [[ -f $realpath ]]; then (command -v bat >/dev/null && bat --style=plain --color=always -n "$realpath") || head -200 "$realpath"; \
else print -r -- "$realpath"; fi'

# Preview for `cd` specifically
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'ls -la "$realpath"'

# Allow jumping between grouped completions
zstyle ':fzf-tab:*' switch-group '<' '>'

plugins=(
    aws
    brew
    direnv
    docker
    docker-compose
    fzf
    fzf-tab
    git
    golang
    history-substring-search
    ssh
    zoxide
    zsh-autosuggestions
    zsh-syntax-highlighting
)

source $ZSH/oh-my-zsh.sh

[[ -s "$HOME/.zsh/home.zsh" ]] && source "$HOME/.zsh/home.zsh"                          # load home specific variables
[[ -s "$HOME/.zsh/local.zsh" ]] && source "$HOME/.zsh/local.zsh"                        # load environment variables and secret keys
[[ -s "$HOME/.zsh/scripts.zsh" ]] && source "$HOME/.zsh/scripts.zsh"                    # load functions
[[ -s "$HOME/.zsh/alias.zsh" ]] && source "$HOME/.zsh/alias.zsh"                        # load aliases
[[ -s "$HOME/.zsh/ctrl-z.zsh" ]] && source "$HOME/.zsh/ctrl-z.zsh"                      # load ctrl-z command
[[ -s "$HOME/.zsh/zsh-autocomplete.zsh" ]] && source "$HOME/.zsh/zsh-autocomplete.zsh"  # load zsh-autocomplete
[[ -s "$HOME/.zsh/key-bindings.zsh" ]] && source "$HOME/.zsh/key-bindings.zsh"          # load key bindings
[[ -s "$HOME/.zsh/devnet.zsh" ]] && source "$HOME/.zsh/devnet.zsh"                      # load devnet development related helpers
[[ -s "$HOME/.zsh/history.zsh" ]] && source "$HOME/.zsh/history.zsh"                    # load devnet development related helpers

[[ -s "$HOME/.zsh/cb.zsh" ]] && source "$HOME/.zsh/cb.zsh"                              # load cb env vars
[[ -s "$HOME/.zsh/salus.zsh" ]] && source "$HOME/.zsh/salus.zsh"                        # load salus command

# list of themes for oh-my-posh
# https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/refs/heads/main/themes/amro.omp.json
# https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/refs/heads/main/themes/emodipt-extend.omp.json
# https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/refs/heads/main/themes/honukai.omp.json
# https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/refs/heads/main/themes/material.omp.json
# https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/refs/heads/main/themes/negligible.omp.json
# https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/refs/heads/main/themes/sim-web.omp.json
eval "$(oh-my-posh init zsh --config https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/refs/heads/main/themes/emodipt-extend.omp.json)"

eval "$(zoxide init zsh)"
# eval "$(fzf --zsh)"
